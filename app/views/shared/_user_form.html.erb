<% action = (mode == :new_session) ? session_url : users_url%>
<form action="<%= action%>" method="post">
   <%= auth_token %>
   <!-- protects  from CSRF attacks -->
   <label for="user_name">Username:</label>
   <input id="user_name" type="text" name="user[user_name]">

   <label for="password">Password:</label>
   <input id="password" type="password" name="user[password]">
   <input type="submit" value="<%= mode == :new_session ? 'Log me in!' : 'Sign me up!' %>">
</form>